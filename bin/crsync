#!/bin/bash -e

OPTIND=1

fetch_only=0
force=0

# Delete my gyp state file to force crbuild to regyp
rm -f .GYP_STATE

while getopts "fF" opt; do
  case "$opt" in
  f)  fetch_only=1
      ;;
  F)  force=1
      ;;
  esac
done

shift $((OPTIND-1))

if [[ "${force}" == "0" ]]; then
  chrome-tree-open
fi

top_dir=`pwd`

# Update depot tools
gclient --version
gclient --version

echo ""
echo "Updating/rebasing Chromium..."
cd ${top_dir}
if [[ "${fetch_only}" == "0" ]]; then
  git rebase-update
fi

echo ""
echo "Updating/rebasing Leveldb"
cd ${top_dir}/third_party/leveldatabase/src
if [[ "${fetch_only}" == "0" ]]; then
  git rebase-update
fi

echo ""
  if [[ "${fetch_only}" == "0" ]]; then
  echo "Syncing all projects..."
  cd ${top_dir}
  gclient sync
fi
